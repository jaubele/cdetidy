% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/safe_fwrite_warehouse.R
\name{safe_fwrite_warehouse}
\alias{safe_fwrite_warehouse}
\title{Safely write a warehouse-ready CSV file with metadata logging}
\usage{
safe_fwrite_warehouse(
  data,
  path = NULL,
  char_cols = c("cds", "county_code", "district_code", "school_code"),
  compress = FALSE,
  n_check = 6,
  log_metadata = NULL,
  data_year = NULL,
  data_source = NULL,
  data_description = NA,
  user_note = NA,
  table_name = NULL,
  dim_description = NULL,
  log_path = "export_log.csv",
  canonical_table_id = NULL,
  dimension_type = NULL
)
}
\arguments{
\item{data}{A data frame to be exported.}

\item{path}{Optional. A full file path to write the CSV file. If \code{NULL}, a default path is constructed using metadata fields.}

\item{char_cols}{A character vector of column names to force as character before export. Defaults to key ID fields (\code{cds}, \code{county_code}, etc.).}

\item{compress}{Logical. If \code{TRUE}, writes the file as a gzipped \code{.csv.gz}. Default is \code{FALSE}.}

\item{n_check}{Number of rows to preview (with \code{fread()}) after writing. Default is 6.}

\item{log_metadata}{Optional. A named list containing key metadata: \code{data_year}, \code{data_source}, \code{data_description}, \code{user_note}.}

\item{data_year}{Data year (numeric or character) — required if \code{log_metadata} is not supplied.}

\item{data_source}{A string describing the data source (e.g., \code{"CDE"}, \code{"Dashboard"}).}

\item{data_description}{A short description of the dataset (e.g., \code{"Absenteeism summary by subgroup"}).}

\item{user_note}{A comment describing the export context (must include \code{"fact"} or \code{"dim"} to infer table type).}

\item{table_name}{Base name for the output table.}

\item{dim_description}{Optional. A short, clean label for the dimension table (used in the file name).}

\item{log_path}{Path to the export log CSV file. Default is \code{"export_log.csv"} within the warehouse structure.}

\item{canonical_table_id}{Optional. A unique identifier for the export record. Defaults to \code{table_name}.}

\item{dimension_type}{Optional. Type of dimension table (\code{"universal"}, \code{"annualized"}, or \code{"other"}).}
}
\value{
Invisibly returns \code{NULL}. The function writes the CSV and appends (or updates) a log entry.
}
\description{
Exports a data frame to a standardized warehouse folder structure (e.g., T drive), ensures
correct character formatting for ID fields, applies optional compression, and logs relevant
metadata to a centralized export log. The function enforces expected naming and structural
conventions for OCDE’s data warehouse and supports both fact and dimension tables.
}
\details{
\itemize{
\item Constructs a file name of the form: \verb{<table_name>_<dim_description>_<fact|dim>.csv}
\item Ensures ID columns (e.g., \code{cds}) are properly coerced to character
\item Automatically creates subdirectories if they don't exist
\item Overwrites an existing log entry if the \code{canonical_table_id} matches
}
}
\seealso{
\code{\link[=safe_fwrite]{safe_fwrite()}} for the general version that is not warehouse-specific.
}
