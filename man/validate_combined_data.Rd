% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/validate_combined_data.R
\name{validate_combined_data}
\alias{validate_combined_data}
\title{Validate a joined vs. distinct dataset and return the deduplicated frame}
\usage{
validate_combined_data(
  data,
  key_cols,
  check_pk = TRUE,
  include_year = TRUE,
  id_cols = c("cds", "district_code", "school_code"),
  show_examples = 10,
  ...
)
}
\arguments{
\item{data}{A data frame that represents the **joined** data (may contain duplicates).}

\item{key_cols}{Character vector of columns that should uniquely identify rows
in the *distinct* data (e.g., `c("cds","year")`, `c("district_code","year")`).}

\item{check_pk}{Logical; if `TRUE` (default), run
[validate_primary_key()] on the distinct data and report the result.
Extra arguments are forwarded via `...`.}

\item{include_year}{Logical; when `TRUE` (default) and a column named
`"year"` exists in both data frames, coverage checks use `(id, year)`
pairs; otherwise they use the ID alone.}

\item{id_cols}{Character vector of ID columns to audit for coverage.
Defaults to `c("cds","district_code","school_code")`. Only IDs that are
actually present in `data` are checked.}

\item{show_examples}{Integer; how many example missing keys to print if any
joined keys are not found in the distinct data. Default `10`.}

\item{...}{Additional arguments passed to [validate_primary_key()]
(e.g., `sample_n`, `full_run`, `seed`).}
}
\value{
The **distinct** data frame (`dplyr::distinct(data)`), invisibly
  printing coverage and (optionally) primary-key validation messages.
}
\description{
Creates a fully distinct version of a *joined* dataset (across all columns),
verifies that every ID (optionally by year) present in the joined data
also appears in the distinct data, and (optionally) checks that the
supplied key columns form a primary key on the distinct data.
}
\details{
This is meant for annualized “combined” dims where multiple files/years are
row-bound first, then deduplicated into a single canonical table.
Informative messages are printed with **cli**.


- Coverage check: for each ID in `id_cols` that exists in `data`, confirms
  that all `(id[, year])` keys from the joined data also appear in the
  distinct data; prints examples if not.
- Primary-key check: if `check_pk = TRUE`, calls
  [validate_primary_key(distinct_df, key_cols, ...)] and reports success/failure.
}
\examples{
\dontrun{
# Districts example
districts_distinct <- validate_combined_data(
  data = assessment_districts_joined,
  key_cols = c("district_code", "year"),
  full_run = TRUE
)

# Schools example (sample PK check for speed)
schools_distinct <- validate_combined_data(
  data = assessment_schools_joined,
  key_cols = c("school_code", "year"),
  sample_n = 10000, full_run = FALSE
)
}

}
\seealso{
[validate_primary_key()]
}
